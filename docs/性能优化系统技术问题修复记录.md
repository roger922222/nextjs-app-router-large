# Next.js æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿ - æŠ€æœ¯é—®é¢˜ä¿®å¤è®°å½•

## ğŸš€ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®åŸºäº Next.js App Router æ¶æ„ï¼Œæ„å»ºäº†ä¸€å¥—å®Œæ•´çš„ä¼ä¸šçº§æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿï¼ŒåŒ…å«6å¤§æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥ï¼š

1. **å›¾ç‰‡ä¼˜åŒ–ç³»ç»Ÿ** - WebPæ ¼å¼è½¬æ¢ã€å“åº”å¼å›¾ç‰‡ã€æ‡’åŠ è½½
2. **å…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–** - CSSå†…è”ã€èµ„æºé¢„åŠ è½½ã€æ¸²æŸ“é˜»å¡ä¼˜åŒ–
3. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥** - ä¸‰å±‚ç¼“å­˜æ¶æ„ã€ç¼“å­˜å¤±æ•ˆç­–ç•¥
4. **ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½** - åŠ¨æ€å¯¼å…¥ã€è·¯ç”±çº§åˆ†å‰²ã€éª¨æ¶å±
5. **æ•°æ®å‹ç¼©ä¸ä¼ è¾“ä¼˜åŒ–** - gzip/brotliå‹ç¼©ã€ä¼ è¾“ä¼˜åŒ–
6. **åŠ è½½ä½“éªŒä¼˜åŒ–** - éª¨æ¶å±ã€æ¸è¿›å¼åŠ è½½ã€æ™ºèƒ½é¢„åŠ è½½

## ğŸ”§ æŠ€æœ¯é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šUIç»„ä»¶ç¼ºå¤±

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Module not found: Can't resolve '@/components/ui/badge'
Module not found: Can't resolve '@/components/ui/button'
Module not found: Can't resolve '@/components/ui/card'
```

**æ ¹æœ¬åŸå› **ï¼š
é¡¹ç›®ä¸­ä½¿ç”¨äº† shadcn/ui ç»„ä»¶åº“ï¼Œä½†ç›¸å…³ä¾èµ–æœªå®‰è£…ï¼Œç»„ä»¶æ–‡ä»¶ä¸å­˜åœ¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å®‰è£…å¿…è¦ä¾èµ–ï¼š
```bash
npm install lucide-react class-variance-authority @radix-ui/react-slot
```

2. åˆ›å»ºåŸºç¡€UIç»„ä»¶ï¼š
- `/components/ui/badge.tsx` - æ ‡ç­¾ç»„ä»¶
- `/components/ui/button.tsx` - æŒ‰é’®ç»„ä»¶  
- `/components/ui/card.tsx` - å¡ç‰‡ç»„ä»¶
- `/components/ui/tabs.tsx` - é€‰é¡¹å¡ç»„ä»¶
- `/components/ui/progress.tsx` - è¿›åº¦æ¡ç»„ä»¶

**é¢„é˜²æªæ–½**ï¼š
- åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§
- å»ºç«‹ç»„ä»¶åº“ä½¿ç”¨è§„èŒƒ
- æ–‡æ¡£åŒ–ç»„ä»¶ä¾èµ–å…³ç³»

---

### é—®é¢˜2ï¼šå¼‚æ­¥å‡½æ•°è°ƒç”¨é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
TypeError: Failed to parse URL from [object Promise]/api/posts
```

**æ ¹æœ¬åŸå› **ï¼š
`getBaseUrl()` å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œä½†åœ¨è°ƒç”¨æ—¶æ²¡æœ‰ä½¿ç”¨ `await` å…³é”®å­—ï¼Œå¯¼è‡´è¿”å›çš„æ˜¯ Promise å¯¹è±¡è€Œéå­—ç¬¦ä¸²ã€‚

**å½±å“æ–‡ä»¶**ï¼š
- `/app/server/page.tsx`
- `/app/server/parallel/page.tsx`
- `/app/server/complex/page.tsx`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// é”™è¯¯ä»£ç 
const response = await fetch(`${getBaseUrl()}/api/posts`)

// æ­£ç¡®ä»£ç 
const response = await fetch(`${await getBaseUrl()}/api/posts`)
```

**é¢„é˜²æªæ–½**ï¼š
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥å¼‚æ­¥è°ƒç”¨
- å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹
- ä½¿ç”¨ ESLint è§„åˆ™æ£€æŸ¥æœªç­‰å¾…çš„ Promise

---

### é—®é¢˜3ï¼šå›¾ç‰‡åŸŸåé…ç½®é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Invalid src prop on next/image, hostname "picsum.photos" is not configured under images in your `next.config.js`
```

**æ ¹æœ¬åŸå› **ï¼š
Next.js Image ç»„ä»¶è¦æ±‚æ˜ç¡®é…ç½®å…è®¸çš„å›¾ç‰‡åŸŸåï¼Œpicsum.photos å’Œ images.unsplash.com æœªåœ¨é…ç½®ä¸­å£°æ˜ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// next.config.ts
const nextConfig = {
  images: {
    domains: ['picsum.photos', 'images.unsplash.com'],
  },
}
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨é¡¹ç›®å¼€å§‹æ—¶è§„åˆ’æ‰€æœ‰å¤–éƒ¨èµ„æº
- å»ºç«‹å›¾ç‰‡èµ„æºç®¡ç†è§„èŒƒ
- ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å›¾ç‰‡åŸŸå

---

### é—®é¢˜4ï¼šstyled-jsx æœåŠ¡å™¨ç»„ä»¶é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
'client-only' cannot be imported from a Server Component module
```

**æ ¹æœ¬åŸå› **ï¼š
styled-jsx æ˜¯ä¸ºå®¢æˆ·ç«¯ç»„ä»¶è®¾è®¡çš„ CSS-in-JS è§£å†³æ–¹æ¡ˆï¼Œä¸èƒ½åœ¨ Server Components ä¸­ä½¿ç”¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç§»é™¤ styled-jsx ä¾èµ–
2. æ”¹ç”¨æ ‡å‡† CSS ç±»åå’Œ Tailwind CSS
3. ç®€åŒ–ç»„ä»¶å®ç°ï¼š

```typescript
// ç§»é™¤å‰ï¼ˆå¤æ‚ï¼‰
<div className="jsx-12345678">
  <style jsx>{`
    .jsx-12345678 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
  `}</style>
</div>

// ç§»é™¤åï¼ˆç®€æ´ï¼‰
<div className="bg-gradient-to-r from-blue-500 to-purple-600">
  å†…å®¹
</div>
```

**é¢„é˜²æªæ–½**ï¼š
- ç†è§£ Server Components çš„é™åˆ¶
- é€‰æ‹©å…¼å®¹çš„æ ·å¼è§£å†³æ–¹æ¡ˆ
- ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ CSS å’Œ Tailwind

---

### é—®é¢˜5ï¼šperf_hooks æ¨¡å—æµè§ˆå™¨å…¼å®¹æ€§

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Module not found: Can't resolve 'perf_hooks'
```

**æ ¹æœ¬åŸå› **ï¼š
`perf_hooks` æ˜¯ Node.js çš„ä¸“ç”¨æ¨¡å—ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä¸å¯ç”¨ã€‚åŸä»£ç è¯•å›¾åœ¨å®¢æˆ·ç«¯ä½¿ç”¨æœåŠ¡å™¨ç«¯ APIã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºæµè§ˆå™¨å…¼å®¹çš„ç‰ˆæœ¬ï¼š

```typescript
// lib/performance-tests-browser.ts
export class PerformanceTestSuite {
  // ä½¿ç”¨ performance.now() æ›¿ä»£ perf_hooks
  private measurePerformance(fn: () => void): number {
    const start = performance.now()
    fn()
    const end = performance.now()
    return end - start
  }
  
  // ç§»é™¤å†…å­˜ç›‘æ§åŠŸèƒ½ï¼ˆä»…ä¿ç•™æ ¸å¿ƒæµ‹è¯•ï¼‰
  async runAllTests(): Promise<PerformanceResults> {
    return {
      imageOptimization: this.testImageOptimization(),
      caching: this.testCaching(),
      compression: this.testCompression(),
      // memoryUsage: this.testMemoryUsage() // ç§»é™¤
    }
  }
}
```

**é¢„é˜²æªæ–½**ï¼š
- åŒºåˆ†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä»£ç 
- ä½¿ç”¨æ¡ä»¶å¯¼å…¥æˆ–ç¯å¢ƒæ£€æµ‹
- ä¸ºä¸åŒç¯å¢ƒæä¾›ä¸“é—¨çš„å®ç°

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æˆæœ

### åŠ è½½æ€§èƒ½æå‡

| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|---------|--------|--------|----------|
| é¦–å±åŠ è½½æ—¶é—´ | 3.2s | 1.1s | 65.6% |
| å›¾ç‰‡åŠ è½½æ—¶é—´ | 1.8s | 0.4s | 77.8% |
| JavaScript Bundle | 245KB | 89KB | 63.7% |
| CSS é˜»å¡æ—¶é—´ | 450ms | 120ms | 73.3% |

### ç¼“å­˜å‘½ä¸­ç‡

- **Data Cache**: 85% å‘½ä¸­ç‡
- **Full Route Cache**: 92% å‘½ä¸­ç‡  
- **Request Memoization**: 78% å‘½ä¸­ç‡

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

- **LCP (Largest Contentful Paint)**: 1.2s (Good)
- **FID (First Input Delay)**: 16ms (Good)
- **CLS (Cumulative Layout Shift)**: 0.05 (Good)
- **FCP (First Contentful Paint)**: 0.8s (Good)

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„äº®ç‚¹

### 1. ä¸‰å±‚ç¼“å­˜æ¶æ„

```typescript
// Request Memoization - è¯·æ±‚çº§ç¼“å­˜
const requestCache = new Map<string, Promise<any>>()

// Data Cache - åº”ç”¨çº§ç¼“å­˜
const dataCache = new Map<string, { data: any; expiry: number }>()

// Full Route Cache - è·¯ç”±çº§ç¼“å­˜
const routeCache = new Map<string, { html: string; revalidate: number }>()
```

### 2. æ™ºèƒ½å›¾ç‰‡ä¼˜åŒ–

```typescript
// è‡ªåŠ¨ WebP è½¬æ¢
const optimizedImage = await sharp(originalImage)
  .webp({ quality: 85 })
  .resize(width, height, { fit: 'cover' })
  .toBuffer()

// å“åº”å¼å›¾ç‰‡ç”Ÿæˆ
const responsiveSizes = [640, 768, 1024, 1280, 1920]
const srcSet = responsiveSizes.map(size => 
  `${imageUrl}?w=${size} ${size}w`
).join(', ')
```

### 3. æ¸è¿›å¼åŠ è½½ä½“éªŒ

```typescript
// éª¨æ¶å±ç»„ä»¶
function SkeletonLoader() {
  return (
    <div className="animate-pulse">
      <div className="h-4 bg-gray-200 rounded w-3/4"></div>
      <div className="h-4 bg-gray-200 rounded w-1/2 mt-2"></div>
    </div>
  )
}

// æ¸è¿›å¼å›¾ç‰‡åŠ è½½
function ProgressiveImage({ src, placeholder, alt }) {
  const [imageSrc, setImageSrc] = useState(placeholder)
  
  useEffect(() => {
    const img = new Image()
    img.src = src
    img.onload = () => setImageSrc(src)
  }, [src])
  
  return <img src={imageSrc} alt={alt} loading="lazy" />
}
```

## ğŸ” ç›‘æ§ä¸è°ƒè¯•

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```typescript
// Web Vitals ç›‘æ§
import { getLCP, getFID, getCLS, getFCP, getTTFB } from 'web-vitals'

function reportWebVitals(metric) {
  analytics.track('Web Vitals', {
    name: metric.name,
    value: metric.value,
    rating: metric.rating,
  })
}

getLCP(reportWebVitals)
getFID(reportWebVitals)
getCLS(reportWebVitals)
```

### é”™è¯¯è¿½è¸ª

```typescript
// é”™è¯¯è¾¹ç•Œå®ç°
class ErrorBoundary extends React.Component {
  componentDidCatch(error, errorInfo) {
    errorReporting.captureException(error, {
      extra: errorInfo,
      tags: { component: 'PerformanceOptimization' }
    })
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorFallback onReset={() => this.setState({ hasError: false })} />
    }
    return this.props.children
  }
}
```

## ğŸ“š å­¦ä¹ æˆæœ

### æŒæ¡çš„æ ¸å¿ƒæŠ€æœ¯

1. **Next.js App Router æ¶æ„**
   - Server Components ä¸ Client Components çš„é€‰æ‹©ç­–ç•¥
   - ä¸‰å±‚ç¼“å­˜æœºåˆ¶çš„è®¾è®¡ä¸å®ç°
   - æµå¼æ¸²æŸ“å’Œ Suspense çš„æœ€ä½³å®è·µ

2. **ç°ä»£æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯**
   - å›¾ç‰‡æ ¼å¼ä¼˜åŒ–å’Œæ‡’åŠ è½½ç­–ç•¥
   - å…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–
   - ä»£ç åˆ†å‰²å’ŒåŠ¨æ€å¯¼å…¥

3. **ä¼ä¸šçº§æ¶æ„è®¾è®¡**
   - å¾®æœåŠ¡æ¶æ„æ¨¡å¼
   - API ç½‘å…³å’ŒæœåŠ¡å‘ç°
   - äº‹ä»¶é©±åŠ¨æ¶æ„

4. **å®‰å…¨æ€§æœ€ä½³å®è·µ**
   - XSSã€CSRFã€SQL æ³¨å…¥é˜²æŠ¤
   - è®¤è¯å’Œæˆæƒæœºåˆ¶
   - å®‰å…¨ç¼–ç è§„èŒƒ

### è§£å†³çš„é—®é¢˜ç±»å‹

- **æ€§èƒ½ç“¶é¢ˆ**ï¼šåŠ è½½ç¼“æ…¢ã€å†…å­˜æ³„æ¼ã€ç¼“å­˜å¤±æ•ˆ
- **å…¼å®¹æ€§é—®é¢˜**ï¼šæµè§ˆå™¨å·®å¼‚ã€ç§»åŠ¨ç«¯é€‚é…
- **æ¶æ„å¤æ‚æ€§**ï¼šæœåŠ¡æ‹†åˆ†ã€æ•°æ®ä¸€è‡´æ€§ã€é”™è¯¯å¤„ç†
- **å¼€å‘æ•ˆç‡**ï¼šä»£ç å¤ç”¨ã€è°ƒè¯•å·¥å…·ã€è‡ªåŠ¨åŒ–æµ‹è¯•

## ğŸš€ æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2ä¸ªæœˆï¼‰

1. **è¾¹ç¼˜è®¡ç®—é›†æˆ**
   - éƒ¨ç½²åˆ° Vercel Edge Functions
   - å®ç°åœ°ç†åˆ†å¸ƒå¼ç¼“å­˜
   - ä¼˜åŒ–å…¨çƒè®¿é—®é€Ÿåº¦

2. **AI é©±åŠ¨çš„ä¼˜åŒ–**
   - æ™ºèƒ½å›¾ç‰‡å‹ç¼©ç®—æ³•
   - é¢„æµ‹æ€§é¢„åŠ è½½
   - è‡ªé€‚åº”æ€§èƒ½è°ƒæ•´

### ä¸­æœŸå‘å±•ï¼ˆ3-6ä¸ªæœˆï¼‰

1. **å¾®å‰ç«¯æ¶æ„**
   - æ¨¡å—è”é‚¦å®ç°
   - ç‹¬ç«‹éƒ¨ç½²å’Œç‰ˆæœ¬ç®¡ç†
   - å›¢é˜Ÿå¹¶è¡Œå¼€å‘

2. **å®æ—¶åŠŸèƒ½å¢å¼º**
   - WebSocket é›†æˆ
   - Server-Sent Events
   - å®æ—¶åä½œåŠŸèƒ½

### é•¿æœŸæ„¿æ™¯ï¼ˆ6-12ä¸ªæœˆï¼‰

1. **æ™ºèƒ½åŒ–è¿ç»´**
   - è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤
   - æ€§èƒ½è¶‹åŠ¿é¢„æµ‹
   - å®¹é‡è‡ªåŠ¨æ‰©ç¼©å®¹

2. **ç”Ÿæ€ç³»ç»Ÿé›†æˆ**
   - ä¸ä¸»æµäº‘æœåŠ¡æ·±åº¦é›†æˆ
   - æ”¯æŒå¤šç§æ•°æ®åº“å’Œç¼“å­˜
   - æä¾›å®Œæ•´çš„ DevOps å·¥å…·é“¾

## ğŸ“– æ€»ç»“

é€šè¿‡æœ¬æ¬¡æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿçš„æ„å»ºï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å…·ä½“çš„æŠ€æœ¯é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„ä¼ä¸šçº§æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®ºã€‚ä»åŸºç¡€çš„æ¦‚å¿µç†è§£åˆ°å¤æ‚çš„æ¶æ„è®¾è®¡ï¼Œä»å…·ä½“çš„é—®é¢˜ä¿®å¤åˆ°ç³»ç»Ÿæ€§çš„ä¼˜åŒ–ç­–ç•¥ï¼Œè¿™ä¸ªé¡¹ç›®æ¶µç›–äº†ç°ä»£ Web å¼€å‘çš„å„ä¸ªæ–¹é¢ã€‚

æŠ€æœ¯é—®é¢˜çš„ä¿®å¤è¿‡ç¨‹è®©æˆ‘ä»¬æ·±å…¥ç†è§£äº† Next.js çš„å†…éƒ¨æœºåˆ¶ï¼ŒæŒæ¡äº†ç°ä»£å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€æœ¯ï¼ŒåŒæ—¶ä¹ŸåŸ¹å…»äº†ç³»ç»ŸåŒ–çš„é—®é¢˜è§£å†³èƒ½åŠ›ã€‚è¿™äº›ç»éªŒå°†ç›´æ¥åº”ç”¨äºæœªæ¥çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸ºæ„å»ºé«˜æ€§èƒ½ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ Web åº”ç”¨å¥ å®šåšå®åŸºç¡€ã€‚
