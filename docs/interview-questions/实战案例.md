# Next.js 实战案例大全

## 1. 电商网站完整实现

### 项目架构
```
ecommerce/
├── app/
│   ├── (auth)/          # 认证相关页面
│   ├── (shop)/          # 购物相关页面
│   ├── (user)/          # 用户中心
│   ├── api/             # API 路由
│   └── admin/           # 管理后台
├── components/
├── lib/
└── middleware.ts
```

### 核心功能

#### 产品列表页（ISR + 筛选）
```javascript
// app/(shop)/products/page.tsx
export const revalidate = 3600

export default async function ProductsPage({ searchParams }) {
  const { category, page = 1, sort = 'newest' } = searchParams
  
  const [products, categories] = await Promise.all([
    getProducts({ category, page, sort, limit: 24 }),
    getCategories()
  ])
  
  return (
    <div className="flex gap-8">
      <ProductFilters categories={categories} />
      <ProductGrid 
        products={products.items}
        totalPages={products.totalPages}
        currentPage={page}
      />
    </div>
  )
}
```

#### 购物车状态管理
```javascript
// lib/stores/cart.ts
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

export const useCartStore = create(
  persist(
    (set, get) => ({
      items: [],
      addItem: async (product, quantity = 1) => {
        // API 调用 + 状态更新
        const response = await fetch('/api/cart/items', {
          method: 'POST',
          body: JSON.stringify({ productId: product.id, quantity })
        })
        
        if (response.ok) {
          set((state) => ({
            items: [...state.items, { ...product, quantity }]
          }))
        }
      },
      removeItem: async (itemId) => {
        await fetch(`/api/cart/items/${itemId}`, { method: 'DELETE' })
        set((state) => ({
          items: state.items.filter(item => item.id !== itemId)
        }))
      }
    }),
    { name: 'cart-storage' }
  )
)
```

#### 结账流程
```javascript
// app/(shop)/checkout/page.tsx
'use client'

import { useState } from 'react'
import { ShippingForm, PaymentForm, ReviewOrder } from '@/components/checkout'

const STEPS = ['shipping', 'payment', 'review']

export default function CheckoutPage() {
  const [currentStep, setCurrentStep] = useState(0)
  const [orderData, setOrderData] = useState({})
  
  const handleNext = (data) => {
    setOrderData(prev => ({ ...prev, ...data }))
    setCurrentStep(prev => prev + 1)
  }
  
  const handlePlaceOrder = async () => {
    const response = await fetch('/api/orders', {
      method: 'POST',
      body: JSON.stringify(orderData)
    })
    
    if (response.ok) {
      // 清空购物车，跳转到确认页面
      window.location.href = '/order-confirmation'
    }
  }
  
  return (
    <div>
      <CheckoutProgress currentStep={currentStep} />
      
      {currentStep === 0 && <ShippingForm onNext={handleNext} />}
      {currentStep === 1 && <PaymentForm onNext={handleNext} />}
      {currentStep === 2 && (
        <ReviewOrder 
          data={orderData} 
          onConfirm={handlePlaceOrder}
        />
      )}
    </div>
  )
}
```

## 2. 博客系统实现

### 2.1 架构设计
```
blog/
├── app/
│   ├── blog/
│   │   ├── page.tsx           # 博客列表
│   │   ├── [slug]/
│   │   │   └── page.tsx       # 文章详情
│   │   └── search/
│   │       └── page.tsx       # 搜索页面
│   ├── api/
│   │   ├── posts/             # 文章API
│   │   └── search/            # 搜索API
│   └── admin/
│       └── posts/             # 文章管理
└── components/
    ├── blog/
    └── ui/
```

### 2.2 核心功能

#### 文章列表（ISR + 分页）
```javascript
// app/blog/page.tsx
export const revalidate = 3600

export default async function BlogPage({ searchParams }) {
  const page = parseInt(searchParams.page || '1')
  const category = searchParams.category
  
  const posts = await getPosts({ 
    page, 
    limit: 10, 
    category,
    status: 'published' 
  })
  
  return (
    <div>
      <BlogHeader />
      <PostList posts={posts.items} />
      <Pagination 
        currentPage={page}
        totalPages={posts.totalPages}
        baseUrl="/blog"
      />
    </div>
  )
}
```

#### 文章详情（动态路由）
```javascript
// app/blog/[slug]/page.tsx
export async function generateStaticParams() {
  const posts = await getAllPosts()
  return posts.map(post => ({
    slug: post.slug
  }))
}

export default async function BlogPostPage({ params }) {
  const post = await getPostBySlug(params.slug)
  
  if (!post) {
    notFound()
  }
  
  // 并行获取相关数据
  const [relatedPosts, comments] = await Promise.all([
    getRelatedPosts(post.id, 3),
    getComments(post.id)
  ])
  
  return (
    <article>
      <PostHeader post={post} />
      <PostContent content={post.content} />
      <PostFooter post={post} />
      
      <RelatedPosts posts={relatedPosts} />
      <CommentsSection 
        postId={post.id} 
        comments={comments}
      />
    </article>
  )
}
```

#### 搜索功能（客户端）
```javascript
// app/blog/search/page.tsx
'use client'

import { useState, useEffect } from 'react'
import { useDebounce } from '@/lib/hooks'

export default function SearchPage() {
  const [query, setQuery] = useState('')
  const [results, setResults] = useState([])
  const [isLoading, setIsLoading] = useState(false)
  
  const debouncedQuery = useDebounce(query, 300)
  
  useEffect(() => {
    if (debouncedQuery) {
      searchPosts(debouncedQuery)
    } else {
      setResults([])
    }
  }, [debouncedQuery])
  
  const searchPosts = async (searchQuery: string) => {
    setIsLoading(true)
    
    try {
      const response = await fetch(`/api/search?q=${encodeURIComponent(searchQuery)}`)
      const data = await response.json()
      setResults(data.posts)
    } catch (error) {
      console.error('Search failed:', error)
    } finally {
      setIsLoading(false)
    }
  }
  
  return (
    <div>
      <SearchInput 
        value={query}
        onChange={setQuery}
        placeholder="Search posts..."
      />
      
      {isLoading && <SearchSkeleton />}
      
      {!isLoading && results.length > 0 && (
        <SearchResults results={results} />
      )}
      
      {!isLoading && query && results.length === 0 && (
        <NoResults query={query} />
      )}
    </div>
  )
}
```

## 3. 企业官网实现

### 3.1 特点
- 国际化支持
- 多语言切换
- SEO优化
- 性能优化

### 3.2 国际化实现
```javascript
// i18n/config.ts
export const i18nConfig = {
  locales: ['en', 'zh', 'ja'],
  defaultLocale: 'en',
  localePrefix: 'as-needed'
}

// middleware.ts
import { i18nMiddleware } from 'next-i18n-router'
import { i18nConfig } from './i18n/config'

export default i18nMiddleware(i18nConfig)
```

### 3.3 多语言页面
```javascript
// app/[locale]/page.tsx
export default function HomePage({ params: { locale } }) {
  const t = useTranslations('HomePage')
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
      
      <LanguageSwitcher />
    </div>
  )
}
```

## 4. 管理后台实现

### 4.1 权限管理
```javascript
// lib/auth/permissions.ts
export const permissions = {
  admin: ['users.manage', 'posts.manage', 'settings.manage'],
  editor: ['posts.manage'],
  user: ['profile.view']
}

// components/ProtectedRoute.tsx
export function ProtectedRoute({ children, requiredPermission }) {
  const { user, hasPermission } = useAuth()
  
  if (!user || !hasPermission(requiredPermission)) {
    return <AccessDenied />
  }
  
  return children
}
```

### 4.2 数据表格
```javascript
// components/DataTable.tsx
export function DataTable({ data, columns, onRowClick }) {
  const [sortConfig, setSortConfig] = useState(null)
  const [filter, setFilter] = useState('')
  
  const sortedData = useMemo(() => {
    if (!sortConfig) return data
    
    return [...data].sort((a, b) => {
      if (a[sortConfig.key] < b[sortConfig.key]) {
        return sortConfig.direction === 'asc' ? -1 : 1
      }
      if (a[sortConfig.key] > b[sortConfig.key]) {
        return sortConfig.direction === 'asc' ? 1 : -1
      }
      return 0
    })
  }, [data, sortConfig])
  
  const filteredData = useMemo(() => {
    if (!filter) return sortedData
    
    return sortedData.filter(item =>
      columns.some(column =>
        String(item[column.key]).toLowerCase().includes(filter.toLowerCase())
      )
    )
  }, [sortedData, filter, columns])
  
  return (
    <div>
      <TableFilter value={filter} onChange={setFilter} />
      
      <table>
        <thead>
          <tr>
            {columns.map(column => (
              <th key={column.key}>
                <TableHeader
                  column={column}
                  onSort={(key, direction) => setSortConfig({ key, direction })}
                />
              </th>
            ))}
          </tr>
        </thead>
        
        <tbody>
          {filteredData.map((row, index) => (
            <tr key={index} onClick={() => onRowClick?.(row)}>
              {columns.map(column => (
                <td key={column.key}>
                  {column.render ? column.render(row[column.key], row) : row[column.key]}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
      
      <TablePagination
        currentPage={currentPage}
        totalPages={Math.ceil(filteredData.length / pageSize)}
        onPageChange={setCurrentPage}
      />
    </div>
  )
}
```

## 5. 性能优化最佳实践

### 5.1 图片优化
```javascript
// components/OptimizedImage.tsx
import Image from 'next/image'

export function OptimizedImage({ src, alt, priority = false }) {
  return (
    <Image
      src={src}
      alt={alt}
      width={800}
      height={600}
      priority={priority}
      quality={85}
      placeholder="blur"
      blurDataURL={generateBlurDataURL(src)}
      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
    />
  )
}
```

### 5.2 代码分割
```javascript
// 动态导入重型组件
const HeavyComponent = dynamic(
  () => import('@/components/HeavyComponent'),
  {
    loading: () => <Skeleton />,
    ssr: false
  }
)
```

### 5.3 缓存策略
```javascript
// 数据获取缓存
const data = await fetch('https://api.example.com/data', {
  next: {
    revalidate: 3600, // 1小时
    tags: ['products']
  }
})
```

## 6. 部署和监控

### 6.1 部署配置
```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['example.com', 'cdn.example.com'],
    formats: ['image/avif', 'image/webp']
  },
  compress: true,
  poweredByHeader: false,
  generateEtags: true
}
```

### 6.2 性能监控
```javascript
// lib/analytics.ts
export function reportWebVitals(metric: any) {
  // 发送到分析服务
  analytics.track('Web Vitals', {
    name: metric.name,
    value: metric.value,
    rating: metric.rating
  })
}
```

## 总结

这些实战案例展示了 Next.js 在不同类型项目中的应用，包括：

1. **电商网站**: 完整的购物流程、状态管理、支付集成
2. **博客系统**: 内容管理、搜索功能、SEO优化
3. **企业官网**: 国际化、多语言、性能优化
4. **管理后台**: 权限控制、数据表格、CRUD操作

每个案例都包含了最佳实践和性能优化策略，可以作为实际项目开发的参考。