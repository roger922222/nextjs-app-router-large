{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/bytedance/Downloads/nextjs-app-router-large/lib/image-optimization.ts"],"sourcesContent":["// lib/image-optimization.ts\n/**\n * 图片优化工具函数\n * 提供图片压缩、格式转换、懒加载等优化功能\n */\n\nexport interface ImageOptimizationOptions {\n  quality?: number;      // 压缩质量 1-100\n  maxWidth?: number;     // 最大宽度\n  maxHeight?: number;    // 最大高度\n  format?: 'webp' | 'jpeg' | 'png'; // 输出格式\n  fit?: 'cover' | 'contain' | 'fill' | 'inside' | 'outside';\n}\n\n/**\n * 压缩图片\n */\nexport async function compressImage(\n  file: File | Blob,\n  options: ImageOptimizationOptions = {}\n): Promise<Blob> {\n  const {\n    quality = 85,\n    maxWidth = 1920,\n    maxHeight = 1080,\n    format = 'webp',\n    fit = 'inside'\n  } = options;\n\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      const img = new Image();\n      \n      img.onload = () => {\n        try {\n          const canvas = document.createElement('canvas');\n          const ctx = canvas.getContext('2d')!;\n          \n          // 计算压缩后的尺寸\n          let { width, height } = calculateDimensions(\n            img.width,\n            img.height,\n            maxWidth,\n            maxHeight,\n            fit\n          );\n          \n          // 设置canvas尺寸\n          canvas.width = width;\n          canvas.height = height;\n          \n          // 绘制压缩后的图片\n          ctx.drawImage(img, 0, 0, width, height);\n          \n          // 转换为指定格式\n          canvas.toBlob(\n            (blob) => {\n              if (blob) {\n                resolve(blob);\n              } else {\n                reject(new Error('Failed to compress image'));\n              }\n            },\n            `image/${format}`,\n            quality / 100\n          );\n        } catch (error) {\n          reject(error);\n        }\n      };\n      \n      img.onerror = () => reject(new Error('Failed to load image'));\n      img.src = e.target?.result as string;\n    };\n    \n    reader.onerror = () => reject(new Error('Failed to read file'));\n    reader.readAsDataURL(file);\n  });\n}\n\n/**\n * 计算压缩后的尺寸\n */\nfunction calculateDimensions(\n  originalWidth: number,\n  originalHeight: number,\n  maxWidth: number,\n  maxHeight: number,\n  fit: string\n): { width: number; height: number } {\n  let width = originalWidth;\n  let height = originalHeight;\n  \n  if (fit === 'inside' || fit === 'contain') {\n    // 保持宽高比，确保图片在指定尺寸内\n    const widthRatio = maxWidth / width;\n    const heightRatio = maxHeight / height;\n    const ratio = Math.min(widthRatio, heightRatio);\n    \n    width = Math.round(width * ratio);\n    height = Math.round(height * ratio);\n  } else if (fit === 'outside' || fit === 'cover') {\n    // 保持宽高比，确保图片覆盖指定区域\n    const widthRatio = maxWidth / width;\n    const heightRatio = maxHeight / height;\n    const ratio = Math.max(widthRatio, heightRatio);\n    \n    width = Math.round(width * ratio);\n    height = Math.round(height * ratio);\n  } else if (fit === 'fill') {\n    // 不保持宽高比，直接填充到指定尺寸\n    width = maxWidth;\n    height = maxHeight;\n  }\n  \n  return { width, height };\n}\n\n/**\n * 生成WebP格式的图片URL\n */\nexport function getWebPUrl(originalUrl: string): string {\n  // 如果已经是WebP格式，直接返回\n  if (originalUrl.includes('.webp')) {\n    return originalUrl;\n  }\n  \n  // 添加WebP转换参数\n  const url = new URL(originalUrl, window.location.origin);\n  url.searchParams.set('format', 'webp');\n  return url.toString();\n}\n\n/**\n * 生成响应式图片srcset\n */\nexport function generateSrcSet(\n  baseUrl: string,\n  widths: number[] = [640, 768, 1024, 1280, 1920]\n): string {\n  return widths\n    .map(width => `${baseUrl}?w=${width} ${width}w`)\n    .join(', ');\n}\n\n/**\n * 生成模糊占位图\n */\nexport function generateBlurDataURL(\n  width: number,\n  height: number,\n  color: string = '#f0f0f0'\n): string {\n  const svg = `\n    <svg width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"100%\" height=\"100%\" fill=\"${color}\"/>\n    </svg>\n  `;\n  \n  return `data:image/svg+xml;base64,${btoa(svg)}`;\n}\n\n/**\n * 检查浏览器是否支持WebP\n */\nexport function isWebPSupported(): boolean {\n  if (typeof window === 'undefined') return false;\n  \n  const canvas = document.createElement('canvas');\n  canvas.width = 1;\n  canvas.height = 1;\n  \n  return canvas.toDataURL('image/webp').indexOf('webp') > -1;\n}\n\n/**\n * 图片预加载\n */\nexport function preloadImage(src: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    \n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = src;\n  });\n}\n\n/**\n * 批量预加载图片\n */\nexport async function preloadImages(srcs: string[]): Promise<HTMLImageElement[]> {\n  const promises = srcs.map(src => preloadImage(src));\n  return Promise.all(promises);\n}\n\n/**\n * 计算图片文件大小\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  \n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  \n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * 获取图片优化建议\n */\nexport function getOptimizationSuggestions(\n  originalSize: number,\n  compressedSize: number,\n  originalFormat: string,\n  compressedFormat: string\n): string[] {\n  const suggestions: string[] = [];\n  const compressionRatio = ((originalSize - compressedSize) / originalSize) * 100;\n  \n  if (compressionRatio > 50) {\n    suggestions.push(`压缩效果优秀，节省了 ${compressionRatio.toFixed(1)}% 的空间`);\n  } else if (compressionRatio > 30) {\n    suggestions.push(`压缩效果良好，节省了 ${compressionRatio.toFixed(1)}% 的空间`);\n  } else {\n    suggestions.push(`压缩效果一般，建议调整压缩参数`);\n  }\n  \n  if (originalFormat !== 'webp' && compressedFormat === 'webp') {\n    suggestions.push('已转换为WebP格式，可进一步减少文件大小');\n  }\n  \n  if (compressedSize > 100 * 1024) { // 100KB\n    suggestions.push('文件仍然较大，建议进一步压缩或减小尺寸');\n  }\n  \n  return suggestions;\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///Users/bytedance/Downloads/nextjs-app-router-large/components/OptimizedImage.tsx"],"sourcesContent":["// components/OptimizedImage.tsx\n\"use client\";\n\nimport Image from 'next/image';\nimport { useState, useEffect } from 'react';\nimport { \n  getWebPUrl, \n  generateBlurDataURL, \n  isWebPSupported,\n  preloadImage \n} from '@/lib/image-optimization';\n\ninterface OptimizedImageProps {\n  src: string;\n  alt: string;\n  width?: number;\n  height?: number;\n  priority?: boolean;\n  quality?: number;\n  className?: string;\n  objectFit?: 'cover' | 'contain' | 'fill';\n  placeholder?: 'blur' | 'empty';\n  blurDataURL?: string;\n  sizes?: string;\n  srcSet?: string;\n  loading?: 'lazy' | 'eager';\n}\n\n/**\n * 优化的图片组件\n * 支持WebP格式、懒加载、模糊占位图等功能\n */\nexport function OptimizedImage({\n  src,\n  alt,\n  width,\n  height,\n  priority = false,\n  quality = 75,\n  className = '',\n  objectFit = 'cover',\n  placeholder = 'blur',\n  blurDataURL,\n  sizes,\n  srcSet,\n  loading = 'lazy'\n}: OptimizedImageProps) {\n  const [imageSrc, setImageSrc] = useState(src);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [webpSupported, setWebpSupported] = useState(true);\n\n  // 检查WebP支持\n  useEffect(() => {\n    setWebpSupported(isWebPSupported());\n  }, []);\n\n  // 优先加载图片\n  useEffect(() => {\n    if (priority) {\n      const optimizedSrc = webpSupported ? getWebPUrl(src) : src;\n      preloadImage(optimizedSrc)\n        .then(() => {\n          setImageSrc(optimizedSrc);\n          setIsLoading(false);\n        })\n        .catch(() => {\n          setImageSrc(src);\n          setError(true);\n        });\n    }\n  }, [src, priority, webpSupported]);\n\n  // 处理图片加载错误\n  const handleError = () => {\n    if (imageSrc !== src) {\n      // 如果WebP加载失败，回退到原格式\n      setImageSrc(src);\n    } else {\n      setError(true);\n    }\n  };\n\n  // 处理图片加载完成\n  const handleLoad = () => {\n    setIsLoading(false);\n  };\n\n  // 生成模糊占位图\n  const getPlaceholderBlur = () => {\n    if (blurDataURL) return blurDataURL;\n    if (width && height) {\n      return generateBlurDataURL(width, height);\n    }\n    return undefined;\n  };\n\n  // 生成响应式srcset\n  const getSrcSet = () => {\n    if (srcSet) return srcSet;\n    \n    // 如果没有提供srcset，根据width生成不同尺寸\n    if (width && !src.includes('?')) {\n      const widths = [320, 640, 768, 1024, 1280, 1920];\n      const validWidths = widths.filter(w => w <= width);\n      \n      return validWidths\n        .map(w => `${src}?w=${w} ${w}w`)\n        .join(', ');\n    }\n    \n    return undefined;\n  };\n\n  // 生成sizes属性\n  const getSizes = () => {\n    if (sizes) return sizes;\n    \n    // 默认的响应式尺寸策略\n    if (width) {\n      return `\n        (max-width: 640px) 100vw,\n        (max-width: 768px) 90vw,\n        (max-width: 1024px) 80vw,\n        (max-width: 1280px) 70vw,\n        ${width}px\n      `.replace(/\\s+/g, ' ').trim();\n    }\n    \n    return '100vw';\n  };\n\n  if (error) {\n    return (\n      <div className={`optimized-image-error ${className}`}>\n        <div className=\"error-placeholder\">\n          <span>图片加载失败</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`optimized-image-container ${className}`}>\n      {isLoading && placeholder === 'blur' && (\n        <div \n          className=\"image-blur-placeholder\"\n          style={{\n            backgroundImage: `url(${getPlaceholderBlur()})`,\n            backgroundSize: objectFit,\n            backgroundPosition: 'center'\n          }}\n        />\n      )}\n      \n      <Image\n        src={imageSrc}\n        alt={alt}\n        width={width}\n        height={height}\n        priority={priority}\n        quality={quality}\n        loading={loading}\n        placeholder={placeholder}\n        blurDataURL={getPlaceholderBlur()}\n        sizes={getSizes()}\n        srcSet={getSrcSet()}\n        onLoad={handleLoad}\n        onError={handleError}\n        style={{\n          objectFit,\n          visibility: isLoading ? 'hidden' : 'visible'\n        }}\n      />\n      \n      {isLoading && (\n        <div className=\"image-loading-indicator\">\n          <div className=\"loading-spinner\" />\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * 图片懒加载包装组件\n */\nexport function LazyImage(props: Omit<OptimizedImageProps, 'loading'>) {\n  return <OptimizedImage {...props} loading=\"lazy\" />;\n}\n\n/**\n * 优先加载的图片组件\n */\nexport function PriorityImage(props: Omit<OptimizedImageProps, 'loading' | 'priority'>) {\n  return <OptimizedImage {...props} loading=\"eager\" priority={true} />;\n}\n\n/**\n * 响应式图片组件\n */\nexport function ResponsiveImage({\n  src,\n  alt,\n  sizes = '100vw',\n  ...props\n}: OptimizedImageProps) {\n  return (\n    <OptimizedImage\n      src={src}\n      alt={alt}\n      sizes={sizes}\n      {...props}\n    />\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///Users/bytedance/Downloads/nextjs-app-router-large/components/ImageOptimizationDemo.tsx"],"sourcesContent":["// components/ImageOptimizationDemo.tsx\n\"use client\";\n\nimport { useState, useEffect } from 'react';\nimport { OptimizedImage, LazyImage, PriorityImage, ResponsiveImage } from './OptimizedImage';\nimport { formatFileSize, compressImage, isWebPSupported } from '@/lib/image-optimization';\nimport './ImageOptimizationDemo.css';\n\n/**\n * 图片优化演示组件\n * 展示各种图片优化技术的使用效果\n */\nexport function ImageOptimizationDemo() {\n  const [webpSupported, setWebPSupported] = useState(true);\n  const [selectedImage, setSelectedImage] = useState<string>('');\n  const [compressionResult, setCompressionResult] = useState<{\n    originalSize: number;\n    compressedSize: number;\n    ratio: number;\n  } | null>(null);\n\n  // 示例图片数据\n  const demoImages = [\n    {\n      id: 1,\n      title: '示例图片 1',\n      originalUrl: 'https://picsum.photos/800/600?random=1',\n      description: '高分辨率风景图片'\n    },\n    {\n      id: 2,\n      title: '示例图片 2', \n      originalUrl: 'https://picsum.photos/600/400?random=2',\n      description: '中等分辨率图片'\n    },\n    {\n      id: 3,\n      title: '示例图片 3',\n      originalUrl: 'https://picsum.photos/400/300?random=3',\n      description: '低分辨率图片'\n    }\n  ];\n\n  useEffect(() => {\n    setWebPSupported(isWebPSupported());\n  }, []);\n\n  // 模拟图片压缩\n  const handleCompressImage = async (imageUrl: string) => {\n    try {\n      const response = await fetch(imageUrl);\n      const blob = await response.blob();\n      \n      const originalSize = blob.size;\n      \n      // 压缩图片\n      const compressedBlob = await compressImage(blob, {\n        quality: 75,\n        maxWidth: 800,\n        maxHeight: 600,\n        format: 'webp'\n      });\n      \n      const compressedSize = compressedBlob.size;\n      const ratio = ((originalSize - compressedSize) / originalSize) * 100;\n      \n      setCompressionResult({\n        originalSize,\n        compressedSize,\n        ratio\n      });\n      \n      setSelectedImage(imageUrl);\n    } catch (error) {\n      console.error('压缩失败:', error);\n    }\n  };\n\n  return (\n    <div className=\"image-optimization-demo\">\n      <div className=\"demo-header\">\n        <h2>图片优化技术演示</h2>\n        <div className=\"webp-status\">\n          WebP支持: <span className={webpSupported ? 'supported' : 'unsupported'}>\n            {webpSupported ? '✅ 支持' : '❌ 不支持'}\n          </span>\n        </div>\n      </div>\n\n      {/* 优化技术对比 */}\n      <section className=\"optimization-comparison\">\n        <h3>优化技术对比</h3>\n        <div className=\"comparison-grid\">\n          {/* 普通图片 */}\n          <div className=\"comparison-item\">\n            <h4>普通图片</h4>\n            <img \n              src=\"https://picsum.photos/400/300?random=10\" \n              alt=\"普通图片\"\n              style={{ width: '100%', height: 'auto' }}\n            />\n            <p>无优化，直接加载</p>\n          </div>\n\n          {/* 优化的图片 */}\n          <div className=\"comparison-item\">\n            <h4>优化图片</h4>\n            <OptimizedImage\n              src=\"https://picsum.photos/400/300?random=11\"\n              alt=\"优化图片\"\n              width={400}\n              height={300}\n              quality={75}\n              placeholder=\"blur\"\n            />\n            <p>WebP格式、懒加载、模糊占位</p>\n          </div>\n\n          {/* 响应式图片 */}\n          <div className=\"comparison-item\">\n            <h4>响应式图片</h4>\n            <ResponsiveImage\n              src=\"https://picsum.photos/400/300?random=12\"\n              alt=\"响应式图片\"\n              width={400}\n              height={300}\n              sizes=\"(max-width: 640px) 100vw, 400px\"\n            />\n            <p>根据屏幕尺寸加载不同大小</p>\n          </div>\n        </div>\n      </section>\n\n      {/* 懒加载演示 */}\n      <section className=\"lazy-loading-demo\">\n        <h3>懒加载演示</h3>\n        <p>向下滚动查看懒加载效果：</p>\n        \n        <div className=\"lazy-images-container\">\n          {Array.from({ length: 10 }, (_, i) => (\n            <div key={i} className=\"lazy-image-item\">\n              <LazyImage\n                src={`https://picsum.photos/300/200?random=${20 + i}`}\n                alt={`懒加载图片 ${i + 1}`}\n                width={300}\n                height={200}\n                placeholder=\"blur\"\n              />\n              <p>图片 {i + 1} - 懒加载</p>\n            </div>\n          ))}\n        </div>\n      </section>\n\n      {/* 压缩效果演示 */}\n      <section className=\"compression-demo\">\n        <h3>压缩效果演示</h3>\n        \n        <div className=\"demo-images\">\n          {demoImages.map((image) => (\n            <div key={image.id} className=\"demo-image-item\">\n              <h4>{image.title}</h4>\n              <OptimizedImage\n                src={image.originalUrl}\n                alt={image.description}\n                width={300}\n                height={200}\n                quality={75}\n                placeholder=\"blur\"\n              />\n              <p>{image.description}</p>\n              \n              <button \n                onClick={() => handleCompressImage(image.originalUrl)}\n                className=\"compress-button\"\n              >\n                测试压缩效果\n              </button>\n            </div>\n          ))}\n        </div>\n\n        {/* 压缩结果展示 */}\n        {compressionResult && (\n          <div className=\"compression-result\">\n            <h4>压缩结果</h4>\n            <div className=\"result-stats\">\n              <div className=\"stat-item\">\n                <span className=\"stat-label\">原始大小:</span>\n                <span className=\"stat-value\">{formatFileSize(compressionResult.originalSize)}</span>\n              </div>\n              <div className=\"stat-item\">\n                <span className=\"stat-label\">压缩后大小:</span>\n                <span className=\"stat-value\">{formatFileSize(compressionResult.compressedSize)}</span>\n              </div>\n              <div className=\"stat-item\">\n                <span className=\"stat-label\">压缩率:</span>\n                <span className=\"stat-value\">{compressionResult.ratio.toFixed(1)}%</span>\n              </div>\n            </div>\n          </div>\n        )}\n      </section>\n\n      {/* 性能指标 */}\n      <section className=\"performance-metrics\">\n        <h3>性能指标</h3>\n        <div className=\"metrics-grid\">\n          <div className=\"metric-card\">\n            <h4>加载时间</h4>\n            <p>优化后图片加载时间减少 40-60%</p>\n          </div>\n          <div className=\"metric-card\">\n            <h4>文件大小</h4>\n            <p>WebP格式可减少 25-35% 文件大小</p>\n          </div>\n          <div className=\"metric-card\">\n            <h4>用户体验</h4>\n            <p>模糊占位图提升感知性能</p>\n          </div>\n          <div className=\"metric-card\">\n            <h4>带宽节省</h4>\n            <p>综合优化可节省 50%+ 带宽</p>\n          </div>\n        </div>\n      </section>\n\n      {/* 使用建议 */}\n      <section className=\"usage-recommendations\">\n        <h3>使用建议</h3>\n        <div className=\"recommendations-list\">\n          <div className=\"recommendation-item\">\n            <h4>🎯 优先加载图片</h4>\n            <p>对于首屏关键图片，使用 PriorityImage 组件确保优先加载</p>\n          </div>\n          <div className=\"recommendation-item\">\n            <h4>🔄 懒加载策略</h4>\n            <p>非首屏图片使用 LazyImage 组件，减少初始加载时间</p>\n          </div>\n          <div className=\"recommendation-item\">\n            <h4>📱 响应式适配</h4>\n            <p>使用 ResponsiveImage 组件，根据屏幕尺寸加载合适大小的图片</p>\n          </div>\n          <div className=\"recommendation-item\">\n            <h4>⚡ 格式优化</h4>\n            <p>优先使用 WebP 格式，提供更好的压缩效果</p>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}